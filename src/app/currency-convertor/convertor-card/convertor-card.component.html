<mat-card class="convertor-card">
  <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="2px">
    <mat-card-header>
      <mat-card-title>Currency Convertor</mat-card-title>
    </mat-card-header>
  </div>
  <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="2px">
    <mat-divider></mat-divider>
  </div>
  <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="2px">
    <mat-card-content align="center">
      <form [formGroup]="convertorForm">
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="2px">
          <mat-form-field>
            <mat-label>Convert from</mat-label>
            <input
              type="text"
              matInput
              formControlName="sourceCurrency"
              id="cc-source-currency"
              maxlength="3"
              minlength="3"
              [matAutocomplete]="sourceCurrencyAuto"
              oninput="this.value = this.value.toUpperCase()"
            />
            <mat-autocomplete autoActiveFirstOption #sourceCurrencyAuto="matAutocomplete">
              <mat-option *ngFor="let currency of filteredSourceCurrencies | async" [value]="currency.currencySymbol">{{
                currency.currencySymbol
              }}</mat-option>
            </mat-autocomplete>
          </mat-form-field>
        </div>
        <div fxLayout="row" fxLayoutAlign="start center">
          <mat-card-actions align="center">
            <button mat-button color="primary" id="cc-switch-currency" (click)="switchCurrencies()">
              <span class="material-icons">
                swap_vert
              </span>
            </button>
          </mat-card-actions>
        </div>
        <div>
          <mat-form-field>
            <mat-label>To</mat-label>
            <input
              type="text"
              matInput
              formControlName="targetCurrency"
              maxlength="3"
              minlength="3"
              id="cc-target-currency"
              [matAutocomplete]="targetCurrencyAuto"
              oninput="this.value = this.value.toUpperCase()"
            />
            <mat-autocomplete autoActiveFirstOption #targetCurrencyAuto="matAutocomplete">
              <mat-option *ngFor="let currency of filteredTargetCurrencies | async" [value]="currency.currencySymbol">{{
                currency.currencySymbol
              }}</mat-option>
            </mat-autocomplete>
          </mat-form-field>
        </div>
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="2px">
          <mat-form-field>
            <mat-label>Amount to convert</mat-label>
            <input
              matInput
              type="text"
              name="Source Amount"
              id="cc-source-amount"
              maxlength="21"
              formControlName="sourceAmount"
              (keyup)="updateSourceAmount($event.target.value)"
              (blur)="convertToFloat($event.target)"
            />
          </mat-form-field>
        </div>
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="2px">
          <div *ngIf="this.convertorForm.invalid">
            <small>
              <mat-error *ngIf="sourceCurrency.invalid">
                <mat-error *ngIf="sourceCurrency.errors['required']">
                  <li>Please enter 'Convert from' currency</li>
                </mat-error>
                <mat-error *ngIf="sourceCurrency.errors['minlength']">
                  <li>'From' currency must be 3 letters</li>
                </mat-error>
                <mat-error *ngIf="sourceCurrency.errors['pattern']">
                  <li>'From' currency must be capital letters</li>
                </mat-error>

                <mat-error *ngIf="sourceCurrency.pending">
                  <li>Validating Support for Currency ...</li>
                </mat-error>
                <mat-error *ngIf="sourceCurrency.errors?.unSupported">
                  <li>This 'From' currency is not supported</li>
                </mat-error>
              </mat-error>
              <mat-error *ngIf="targetCurrency.invalid">
                <mat-error *ngIf="targetCurrency.errors.required">
                  <li>Please enter 'To' currency</li>
                </mat-error>
                <mat-error *ngIf="targetCurrency.errors.pattern">
                  <li>'To' currency must be 3 characters</li>
                </mat-error>
              </mat-error>
              <mat-error *ngIf="sourceAmount.invalid">
                <mat-error *ngIf="sourceAmount.errors.required">
                  <li>Please enter 'Amount to convert'</li>
                </mat-error>
                <mat-error *ngIf="sourceAmount.errors.pattern">
                  <li>Amount must be numeric e.g. 0.12</li>
                  <li>Amount must have no commas.</li>
                  <li>Amount must be less than 1 billion</li>
                  <li>Amount must not have 10 or more trailing decimals</li>
                </mat-error>
              </mat-error>
            </small>
          </div>
        </div>

        <mat-error *ngIf="backendError">
          <app-currency-card-error [error]="backendError"></app-currency-card-error>
        </mat-error>
        <mat-card-actions align="center">
          <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="30px">
            <button
              mat-raised-button
              color="primary"
              matTooltip="Send amount for conversion"
              matTooltipPosition="above"
              id="convertCurrency"
              type="submit"
              (click)="convertCurrency()"
              [disabled]="this.shouldDisableConvertButton()"
            >
              <span class="material-icons">
                arrow_downward
              </span>
              <br />
            </button>

            <button
              mat-raised-button
              color="warn"
              matTooltip="Clear currencies and amount on the form"
              matTooltipPosition="above"
              id="resetConvertorForm"
              type="reset"
              (click)="resetForm()"
            >
              <span class="material-icons">
                refresh
              </span>
              <br />
            </button>
          </div>
        </mat-card-actions>
      </form>
      <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="2px">
        <mat-card-footer align="center">
          <app-currency-conversion-result></app-currency-conversion-result>
        </mat-card-footer>
      </div>
    </mat-card-content>
  </div>
</mat-card>
